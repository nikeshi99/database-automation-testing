trigger: none
pr: none
parameters:
  - name: commithash
    displayName: Enter commit hash
    type: string
resources:
  containers: 
  - container: Liquibase
    image: nikeshi/liquibase:v1
stages:
- stage: rollback
  pool:
    vmImage: 'ubuntu-latest'
  jobs:
  - job: revertDB 
    container: Liquibase
    steps:
    - checkout: self
    - script: |
        liquibase --defaultsFile=Liquibase/liquibase.properties --logLevel=info rollbackSQL nikeshi_${{parameters.commithash}}
        liquibase --defaultsFile=Liquibase/liquibase.properties --logLevel=info rollback nikeshi_${{parameters.commithash}}
- stage: revertRepo
  pool:
    vmImage: 'ubuntu-latest'
  jobs:
  - job: revertChangelogFiles
    steps:
    - checkout: self
    - script: |
        git checkout ${{parameters.commithash}} --path Liquibase/db/changelog