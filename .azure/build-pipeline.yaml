trigger: 
  paths:
    include:
    - Liquibase/
    - .azure/build-pipeline.yaml
    exclude:
    - Liquibase/lib/
    - Liquibase/output_local.sql
pr: none
resources:
  containers: 
  - container: Liquibase
    image: nikeshi/liquibase:v1
stages:
- stage: updatingDatabase
  pool:
    vmImage: 'ubuntu-latest'
  jobs:
  - job: TestLiquibase 
    container: Liquibase
    steps:
    - checkout: self
    - script: |
        liquibase --defaultsFile=Liquibase/liquibase.properties --logLevel=info validate
        liquibase --defaultsFile=Liquibase/liquibase.properties --logLevel=info tag nikeshi_$(Build.SourceVersion)
        liquibase --defaultsFile=Liquibase/liquibase.properties --logLevel=info status --verbose
        liquibase --defaultsFile=Liquibase/liquibase.properties  updateSQl
    displayName: 'Verify Changes'
  - job: DeployDB
    container: Liquibase    
    steps:
    - checkout: self
    - script: |
        liquibase --defaultsFile=Liquibase/liquibase.properties --logLevel=info update
    displayName: 'Finalize'
