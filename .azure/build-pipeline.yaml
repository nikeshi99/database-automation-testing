trigger: 
- main
pr: none
jobs:
- job: DockerBuild

  pool:
    vmImage: 'ubuntu-latest'
  steps:
  - checkout: self
  - task: Docker@2
    inputs:
      containerRegistry: 'Docker Hub'
      repository: 'nikeshi/databaseAutomationTesting'
      command: 'buildAndPush'
      Dockerfile: 'app/src/data-backed-service/Dockerfile'
      buildContext: 'app/src/data-backed-service/'
      tags: |
        latest 
  - script: |
      docker run -d -p 8083:8080 nikeshi/databaseAutomationTesting:v1
      sleep 80
      curl http://localhost:8080/employees/
  # - task: CmdLine@2
  #   displayName: 'Verify Changes'
  #   inputs:
  #   - script: |
  #     docker pull liquibase/liquibase:4.11.0
  #     docker run --rm -v Liquibase:/liquibase/changelog liquibase/liquibase:4.11.0 --defaultsFile=changelog/liquibase.properties --changelogfile=changelog/db/master.mysql.xml  --url jdbc:mysql://35.244.39.57:3306/DBdev --driver=com.mysql.cj.jdbc.Driver --classpath=changelog/lib/mysql-connector-java-8.0.29.jar --logLevel=info validate
  #     docker run --rm -v Liquibase:/liquibase/changelog liquibase/liquibase:4.11.0 --defaultsFile=changelog/liquibase.properties --changelogfile=changelog/db/master.mysql.xml  --url jdbc:mysql://35.244.39.57:3306/DBdev --driver=com.mysql.cj.jdbc.Driver --classpath=changelog/lib/mysql-connector-java-8.0.29.jar --logLevel=info $(Build.BuildId)
  # - script: |
  #     ls -R
  #   displayName: 'File directory'
  # - script: |
  #     docker pull liquibase/liquibase:4.11.0
  #     docker run --rm -v Liquibase:/liquibase/changelog liquibase/liquibase:4.11.0 --defaultsFile=changelog/liquibase.properties --changelogfile=changelog/db/master.mysql.xml  --url jdbc:mysql://35.244.39.57:3306/DBdev --driver=com.mysql.cj.jdbc.Driver --classpath=changelog/lib/mysql-connector-java-8.0.29.jar --logLevel=info updateSQL
  #   displayName: 'Verify Changes'
  # - script: |
  #     docker run --rm -v Liquibase:/liquibase/changelog liquibase/liquibase:4.11.0 --defaultsFile=changelog/liquibase.properties --changelogfile=changelog/db/master.mysql.xml  --url jdbc:mysql://35.244.39.57:3306/DBdev --driver=com.mysql.cj.jdbc.Driver --classpath=changelog/lib/mysql-connector-java-8.0.29.jar --logLevel=info update
  #   displayName: 'Deploy Changes'

